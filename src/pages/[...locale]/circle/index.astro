---
import { getCollection } from "astro:content";
import config, { monolocale } from "$config";
import Base from "$layouts/Base.astro";
import FriendCircle from "$components/FriendCircle.svelte";
import i18nit from "$i18n";

export async function getStaticPaths() {
	return config.i18n.locales.map(locale => ({
		params: { locale: config.i18n.defaultLocale === locale ? undefined : locale }
	}));
}

const { locale = config.i18n.defaultLocale } = Astro.params;
const t = i18nit(locale);

// 服务器端预加载友圈数据
let preloadedData = null;
try {
	const apiUrl = new URL(`/api/friend-circle?locale=${locale}`, Astro.request.url);
	const response = await fetch(apiUrl.toString(), {
		headers: {
			"Cache-Control": "max-age=1800"
		}
	});
	if (response.ok) {
		preloadedData = await response.json();
	}
} catch (error) {
	console.error("Failed to preload friend circle data:", error);
}
---

<Base title={t("navigation.friendCircle")} {locale}>
	<main class="friend-circle-page">
		<FriendCircle {locale} {preloadedData} client:load />
	</main>
</Base>

<style>
	.friend-circle-page {
	width: 100%;
	max-width: 800px;
	margin: 0 auto;
	padding: 1rem;
}
</style>
